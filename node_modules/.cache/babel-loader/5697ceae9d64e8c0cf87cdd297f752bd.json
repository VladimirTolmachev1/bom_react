{"ast":null,"code":"import _objectSpread from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _applyDecoratedDescriptor from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _toConsumableArray from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _dec,\n    _dec2,\n    _class,\n    _class2,\n    _jsxFileName = \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Designer/Designer.js\";\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\n/* eslint-disable prefer-const */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { reduxForm, formValueSelector } from 'redux-form';\nimport DocumentTitle from 'react-document-title';\nimport { connect } from 'react-redux';\nimport { autobind } from 'core-decorators';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport { HelperService } from '../../services';\nimport { DesignerForm, DesignerPreview } from './components';\nimport { AppCleanHOC } from '../../components';\nimport { loadingsSelector, initialValuesSelector, abortPageRequests, getDesignerById, updateDesigner, designerValidation, formFieldNamesSelector } from './modules';\nimport './Designer.scss';\nvar formFieldsSelector = formValueSelector('Designer');\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    loading: loadingsSelector(state),\n    initialValues: initialValuesSelector(state),\n    formValues: formFieldsSelector.apply(void 0, [state].concat(_toConsumableArray(formFieldNamesSelector())))\n  };\n};\n\nvar mapDispatchToProps = {\n  abortPageRequests: abortPageRequests,\n  getDesignerById: getDesignerById,\n  updateDesigner: updateDesigner,\n  designerValidation: designerValidation\n};\nvar Designer = (_dec = connect(mapStateToProps, mapDispatchToProps), _dec2 = reduxForm({\n  form: 'Designer',\n  enableReinitialize: true,\n  validate: designerValidation\n}), _dec(_class = _dec2(_class = AppCleanHOC(_class = (_class2 =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Designer, _Component);\n\n  function Designer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Designer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Designer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      activeTab: 0,\n      logoPixelCrop: {},\n      background_picturePixelCrop: {},\n      logoCrop: {\n        x: 0,\n        y: 0,\n        width: 30,\n        height: 30\n      },\n      background_pictureCrop: {\n        x: 0,\n        y: 0,\n        width: 30,\n        height: 30\n      }\n    };\n    return _this;\n  }\n\n  _createClass(Designer, [{\n    key: \"getCroppedImages\",\n    value: function () {\n      var _getCroppedImages = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(_ref) {\n        var logo, background_picture, _this$state, logoPixelCrop, background_picturePixelCrop, croppedLogo, corppedBgImage;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                logo = _ref.logo, background_picture = _ref.background_picture;\n                _this$state = this.state, logoPixelCrop = _this$state.logoPixelCrop, background_picturePixelCrop = _this$state.background_picturePixelCrop;\n                croppedLogo = logo;\n                corppedBgImage = background_picture;\n\n                if (!(logo && typeof logo !== 'string')) {\n                  _context.next = 8;\n                  break;\n                }\n\n                _context.next = 7;\n                return HelperService.getCroppedImg({\n                  file: logo,\n                  pixelCrop: logoPixelCrop\n                });\n\n              case 7:\n                croppedLogo = _context.sent;\n\n              case 8:\n                if (!(background_picture && typeof background_picture !== 'string')) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.next = 11;\n                return HelperService.getCroppedImg({\n                  file: background_picture,\n                  pixelCrop: background_picturePixelCrop\n                });\n\n              case 11:\n                corppedBgImage = _context.sent;\n\n              case 12:\n                return _context.abrupt(\"return\", {\n                  logo: croppedLogo,\n                  background_picture: corppedBgImage\n                });\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function getCroppedImages(_x) {\n        return _getCroppedImages.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"handleSaveRestaurantLink\",\n    value: function handleSaveRestaurantLink() {\n      var _this$props = this.props,\n          url = _this$props.formValues.url,\n          updateDesigner = _this$props.updateDesigner;\n\n      var _this$getSearch = this.getSearch(),\n          restaurant_id = _this$getSearch.restaurant_id;\n\n      var body = {\n        url: url,\n        restaurant_id: restaurant_id\n      };\n      updateDesigner({\n        body: body\n      });\n    }\n  }, {\n    key: \"onUpdateCLick\",\n    value: function () {\n      var _onUpdateCLick = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(event) {\n        var _this$props2, formValues, updateDesigner, _this$props2$formValu, logo, background_picture, _this$getSearch2, restaurant_id, _ref2, body;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this$props2 = this.props, formValues = _this$props2.formValues, updateDesigner = _this$props2.updateDesigner, _this$props2$formValu = _this$props2.formValues;\n                _this$props2$formValu = _this$props2$formValu === void 0 ? {} : _this$props2$formValu;\n                logo = _this$props2$formValu.logo, background_picture = _this$props2$formValu.background_picture;\n                _this$getSearch2 = this.getSearch(), restaurant_id = _this$getSearch2.restaurant_id;\n                event.preventDefault();\n                _context2.next = 7;\n                return this.getCroppedImages({\n                  logo: logo,\n                  background_picture: background_picture\n                });\n\n              case 7:\n                _ref2 = _context2.sent;\n                logo = _ref2.logo;\n                background_picture = _ref2.background_picture;\n                body = _objectSpread({}, formValues, {\n                  restaurant_id: restaurant_id\n                });\n                delete body.restaurant_name;\n\n                if (typeof logo !== 'string') {\n                  body.logo = logo;\n                }\n\n                if (background_picture && typeof background_picture !== 'string') {\n                  body.background_picture = background_picture;\n                }\n\n                updateDesigner({\n                  body: body\n                });\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function onUpdateCLick(_x2) {\n        return _onUpdateCLick.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"onLogoCrop\",\n    value: function onLogoCrop(crop, pixelCrop) {\n      this.setState({\n        logoCrop: crop,\n        logoPixelCrop: pixelCrop\n      });\n    }\n  }, {\n    key: \"onBackgroundCrop\",\n    value: function onBackgroundCrop(crop, pixelCrop) {\n      this.setState({\n        background_pictureCrop: crop,\n        background_picturePixelCrop: pixelCrop\n      });\n    }\n  }, {\n    key: \"onDropLogo\",\n    value: function onDropLogo(accepted) {\n      var change = this.props.change;\n      change('logo', accepted);\n    }\n  }, {\n    key: \"onDropBackgroundImage\",\n    value: function onDropBackgroundImage(accepted) {\n      var change = this.props.change;\n      change('background_picture', accepted);\n    }\n  }, {\n    key: \"onChangeTab\",\n    value: function onChangeTab(event, activeTab) {\n      this.setState({\n        activeTab: activeTab\n      });\n    }\n  }, {\n    key: \"getSearch\",\n    value: function getSearch() {\n      var search = this.props.location.search;\n      return HelperService.parseSearch(search);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var getDesignerById = this.props.getDesignerById;\n\n      var _this$getSearch3 = this.getSearch(),\n          restaurant_id = _this$getSearch3.restaurant_id;\n\n      getDesignerById({\n        id: restaurant_id\n      });\n    }\n  }, {\n    key: \"getPreviews\",\n    value: function getPreviews() {\n      var _this$props$formValue = this.props.formValues;\n      _this$props$formValue = _this$props$formValue === void 0 ? {} : _this$props$formValue;\n      var logo = _this$props$formValue.logo,\n          background_picture = _this$props$formValue.background_picture;\n      var logoForPreview = logo instanceof File || logo instanceof Blob ? URL.createObjectURL(logo) : logo;\n      var bgForPreview = background_picture instanceof File || background_picture instanceof Blob ? URL.createObjectURL(background_picture) : background_picture;\n      return {\n        logo: logoForPreview,\n        background_picture: bgForPreview\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          activeTab = _this$state2.activeTab,\n          background_pictureCrop = _this$state2.background_pictureCrop,\n          logoCrop = _this$state2.logoCrop;\n      var _this$props$formValue2 = this.props.formValues,\n          logo = _this$props$formValue2.logo,\n          url = _this$props$formValue2.url,\n          background_picture = _this$props$formValue2.background_picture,\n          restaurant_name = _this$props$formValue2.restaurant_name;\n      return React.createElement(DocumentTitle, {\n        title: \"Page designer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 224\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: \"app-static-container designer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 225\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }, \"Restaurant page designer\"), React.createElement(Tabs, {\n        value: activeTab,\n        indicatorColor: \"primary\",\n        className: \"designer__tabs\",\n        onChange: this.onChangeTab,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }, React.createElement(Tab, {\n        label: \"Configuration\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }), React.createElement(Tab, {\n        label: \"Restaurant header preview\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: \"designer__tabs-content\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, activeTab === 0 && React.createElement(DesignerForm, Object.assign({\n        background_pictureCrop: background_pictureCrop,\n        logoCrop: logoCrop,\n        logo: logo,\n        background_picture: background_picture,\n        url: url\n      }, {\n        onDropBackgroundImage: this.onDropBackgroundImage,\n        onDropLogo: this.onDropLogo,\n        onBackgroundCrop: this.onBackgroundCrop,\n        onLogoCrop: this.onLogoCrop,\n        onUpdateCLick: this.onUpdateCLick,\n        handleSaveRestaurantLink: this.handleSaveRestaurantLink\n      }, HelperService.pick(this.props, ['loading', 'invalid', 'change']), {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      })), activeTab === 1 && React.createElement(DesignerPreview, Object.assign({}, this.getPreviews(), {\n        name: restaurant_name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 261\n        },\n        __self: this\n      })))));\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n\n  return Designer;\n}(Component), (_applyDecoratedDescriptor(_class2.prototype, \"handleSaveRestaurantLink\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"handleSaveRestaurantLink\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onUpdateCLick\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onUpdateCLick\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onLogoCrop\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onLogoCrop\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onBackgroundCrop\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onBackgroundCrop\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onDropLogo\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onDropLogo\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onDropBackgroundImage\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onDropBackgroundImage\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onChangeTab\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onChangeTab\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"getPreviews\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"getPreviews\"), _class2.prototype)), _class2)) || _class) || _class) || _class);\nexport { Designer as default };\nDesigner.propTypes = {\n  abortPageRequests: PropTypes.func\n};\nDesigner.defaultProps = {};\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(formFieldsSelector, \"formFieldsSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Designer/Designer.js\");\n  reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Designer/Designer.js\");\n  reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Designer/Designer.js\");\n  reactHotLoader.register(Designer, \"Designer\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Designer/Designer.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Designer/Designer.js"],"names":["React","Component","PropTypes","reduxForm","formValueSelector","DocumentTitle","connect","autobind","Tabs","Tab","HelperService","DesignerForm","DesignerPreview","AppCleanHOC","loadingsSelector","initialValuesSelector","abortPageRequests","getDesignerById","updateDesigner","designerValidation","formFieldNamesSelector","formFieldsSelector","mapStateToProps","state","loading","initialValues","formValues","mapDispatchToProps","Designer","form","enableReinitialize","validate","activeTab","logoPixelCrop","background_picturePixelCrop","logoCrop","x","y","width","height","background_pictureCrop","logo","background_picture","croppedLogo","corppedBgImage","getCroppedImg","file","pixelCrop","props","url","getSearch","restaurant_id","body","event","preventDefault","getCroppedImages","restaurant_name","crop","setState","accepted","change","search","location","parseSearch","id","logoForPreview","File","Blob","URL","createObjectURL","bgForPreview","onChangeTab","onDropBackgroundImage","onDropLogo","onBackgroundCrop","onLogoCrop","onUpdateCLick","handleSaveRestaurantLink","pick","getPreviews","propTypes","func","defaultProps"],"mappings":"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","sourcesContent":["/* eslint-disable prefer-const */\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { reduxForm, formValueSelector } from 'redux-form';\nimport DocumentTitle from 'react-document-title';\nimport { connect } from 'react-redux';\n\nimport { autobind } from 'core-decorators';\n\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport { HelperService } from '../../services';\nimport { DesignerForm, DesignerPreview } from './components';\n\nimport { AppCleanHOC } from '../../components';\n\nimport {\n  loadingsSelector,\n  initialValuesSelector,\n  abortPageRequests,\n  getDesignerById,\n  updateDesigner,\n  designerValidation,\n  formFieldNamesSelector,\n} from './modules';\n\nimport './Designer.scss';\n\nconst formFieldsSelector = formValueSelector('Designer');\n\nconst mapStateToProps = state => ({\n  loading: loadingsSelector(state),\n  initialValues: initialValuesSelector(state),\n  formValues: formFieldsSelector(state, ...formFieldNamesSelector()),\n});\n\nconst mapDispatchToProps = {\n  abortPageRequests,\n  getDesignerById,\n  updateDesigner,\n  designerValidation,\n};\n\nexport default\n@connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)\n@reduxForm({\n  form: 'Designer',\n  enableReinitialize: true,\n  validate: designerValidation,\n})\n@AppCleanHOC\nclass Designer extends Component {\n  state = {\n    activeTab: 0,\n    logoPixelCrop: {},\n    background_picturePixelCrop: {},\n    logoCrop: {\n      x: 0,\n      y: 0,\n      width: 30,\n      height: 30,\n    },\n    background_pictureCrop: {\n      x: 0,\n      y: 0,\n      width: 30,\n      height: 30,\n    },\n  };\n\n  async getCroppedImages({ logo, background_picture }) {\n    const { logoPixelCrop, background_picturePixelCrop } = this.state;\n    let croppedLogo = logo;\n    let corppedBgImage = background_picture;\n\n    if (logo && typeof logo !== 'string') {\n      croppedLogo = await HelperService.getCroppedImg({\n        file: logo,\n        pixelCrop: logoPixelCrop,\n      });\n    }\n\n    if (background_picture && typeof background_picture !== 'string') {\n      corppedBgImage = await HelperService.getCroppedImg({\n        file: background_picture,\n        pixelCrop: background_picturePixelCrop,\n      });\n    }\n\n    return {\n      logo: croppedLogo,\n      background_picture: corppedBgImage,\n    };\n  }\n\n  @autobind\n  handleSaveRestaurantLink() {\n    const {\n      formValues: { url },\n      updateDesigner,\n    } = this.props;\n\n    const { restaurant_id } = this.getSearch();\n\n    const body = {\n      url,\n      restaurant_id,\n    };\n\n    updateDesigner({ body });\n  }\n\n  @autobind\n  async onUpdateCLick(event) {\n    let {\n      formValues,\n      updateDesigner,\n      formValues: { logo, background_picture } = {},\n    } = this.props;\n    const { restaurant_id } = this.getSearch();\n\n    event.preventDefault();\n\n    ({ logo, background_picture } = await this.getCroppedImages({\n      logo,\n      background_picture,\n    }));\n\n    const body = {\n      ...formValues,\n      restaurant_id,\n    };\n\n    delete body.restaurant_name;\n\n    if (typeof logo !== 'string') {\n      body.logo = logo;\n    }\n\n    if (background_picture && typeof background_picture !== 'string') {\n      body.background_picture = background_picture;\n    }\n\n    updateDesigner({ body });\n  }\n\n  @autobind\n  onLogoCrop(crop, pixelCrop) {\n    this.setState({\n      logoCrop: crop,\n      logoPixelCrop: pixelCrop,\n    });\n  }\n\n  @autobind\n  onBackgroundCrop(crop, pixelCrop) {\n    this.setState({\n      background_pictureCrop: crop,\n      background_picturePixelCrop: pixelCrop,\n    });\n  }\n\n  @autobind\n  onDropLogo(accepted) {\n    const { change } = this.props;\n    change('logo', accepted);\n  }\n\n  @autobind\n  onDropBackgroundImage(accepted) {\n    const { change } = this.props;\n    change('background_picture', accepted);\n  }\n\n  @autobind\n  onChangeTab(event, activeTab) {\n    this.setState({ activeTab });\n  }\n\n  getSearch() {\n    const {\n      location: { search },\n    } = this.props;\n    return HelperService.parseSearch(search);\n  }\n\n  componentDidMount() {\n    const { getDesignerById } = this.props;\n    const { restaurant_id } = this.getSearch();\n\n    getDesignerById({ id: restaurant_id });\n  }\n\n  @autobind\n  getPreviews() {\n    const { formValues: { logo, background_picture } = {} } = this.props;\n\n    const logoForPreview =\n      logo instanceof File || logo instanceof Blob\n        ? URL.createObjectURL(logo)\n        : logo;\n    const bgForPreview =\n      background_picture instanceof File || background_picture instanceof Blob\n        ? URL.createObjectURL(background_picture)\n        : background_picture;\n\n    return {\n      logo: logoForPreview,\n      background_picture: bgForPreview,\n    };\n  }\n\n  render() {\n    const { activeTab, background_pictureCrop, logoCrop } = this.state;\n\n    const {\n      formValues: { logo, url, background_picture, restaurant_name },\n    } = this.props;\n\n    return (\n      <DocumentTitle title=\"Page designer\">\n        <div className=\"app-static-container designer\">\n          <h1>Restaurant page designer</h1>\n\n          <Tabs\n            value={activeTab}\n            indicatorColor=\"primary\"\n            className=\"designer__tabs\"\n            onChange={this.onChangeTab}>\n            <Tab label=\"Configuration\" />\n            <Tab label=\"Restaurant header preview\" />\n          </Tabs>\n\n          <div className=\"designer__tabs-content\">\n            {activeTab === 0 && (\n              <DesignerForm\n                {...{\n                  background_pictureCrop,\n                  logoCrop,\n                  logo,\n                  background_picture,\n                  url,\n                }}\n                onDropBackgroundImage={this.onDropBackgroundImage}\n                onDropLogo={this.onDropLogo}\n                onBackgroundCrop={this.onBackgroundCrop}\n                onLogoCrop={this.onLogoCrop}\n                onUpdateCLick={this.onUpdateCLick}\n                handleSaveRestaurantLink={this.handleSaveRestaurantLink}\n                {...HelperService.pick(this.props, [\n                  'loading',\n                  'invalid',\n                  'change',\n                ])}\n              />\n            )}\n            {activeTab === 1 && (\n              <DesignerPreview {...this.getPreviews()} name={restaurant_name} />\n            )}\n          </div>\n        </div>\n      </DocumentTitle>\n    );\n  }\n}\n\nDesigner.propTypes = {\n  abortPageRequests: PropTypes.func,\n};\nDesigner.defaultProps = {};\n"]},"metadata":{},"sourceType":"module"}