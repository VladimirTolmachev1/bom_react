{"ast":null,"code":"import _classCallCheck from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _applyDecoratedDescriptor from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _objectSpread from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\n\nvar _dec,\n    _class,\n    _class2,\n    _class3,\n    _temp,\n    _jsxFileName = \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Checkout/Checkout.js\";\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\nimport React, { PureComponent } from 'react';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { autobind } from 'core-decorators';\nimport { HelperService, CurrencyService } from '../../services';\nimport { Preloader } from '../../components';\nimport { checkoutStepsNames } from '../../modules/checkout/checkout.constants';\nimport { OrderPlacedTab, PaymentDetailsTab, ReviewOrderTab } from './components';\nimport { isRestaurantsLoadingSelector, managedRestaurantSelector, getRestaurantForClient } from '../../modules/restaurants';\nimport { createOrder, // abortPageRequests,\norderIsLoadingSelector, createOrderFromCheckout } from '../../modules/orders';\nimport { isStripeChargeLoadingSelector, activeCheckoutStepSelector, checkoutItemsSelector, totalPriceSelector, clearCheckout, setCheckoutUi, backToRestaurantMenu, removeItemFromCheckout } from '../../modules/checkout';\nimport { removeDish } from '../../modules/dishes';\nimport { setDishOrderModal } from '../../modules/modals/dish-order';\nimport { CheckoutChangeListener } from '../CheckoutChangeListener';\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    order: checkoutItemsSelector(state),\n    totalPrice: totalPriceSelector(state),\n    isOrderCreating: orderIsLoadingSelector(state) || isStripeChargeLoadingSelector(state),\n    restaurantLoading: isRestaurantsLoadingSelector(state),\n    restaurant: managedRestaurantSelector(state),\n    activeStep: activeCheckoutStepSelector(state)\n  };\n};\n\nvar mergeProps = function mergeProps(stateProps, dispatchProps, ownProps) {\n  var dispatch = dispatchProps.dispatch;\n  var activeStep = stateProps.activeStep;\n  var nextStep = activeStep + 1;\n  return _objectSpread({}, stateProps, dispatchProps, ownProps, {\n    actions: _objectSpread({\n      handleNextStep: function handleNextStep() {\n        return dispatch(setCheckoutUi({\n          activeStep: nextStep\n        }));\n      }\n    }, bindActionCreators({\n      setDishOrderModal: setDishOrderModal,\n      removeDish: removeDish,\n      createOrder: createOrder,\n      clearCheckout: clearCheckout,\n      createOrderFromCheckout: createOrderFromCheckout,\n      getRestaurantForClient: getRestaurantForClient,\n      removeItemFromCheckout: removeItemFromCheckout,\n      backToRestaurantMenu: backToRestaurantMenu\n    }, dispatch))\n  });\n};\n\nvar Checkout = (_dec = connect(mapStateToProps, null, mergeProps), _dec(_class = (_class2 = (_temp = _class3 =\n/*#__PURE__*/\nfunction (_PureComponent) {\n  _inherits(Checkout, _PureComponent);\n\n  function Checkout() {\n    _classCallCheck(this, Checkout);\n\n    return _possibleConstructorReturn(this, _getPrototypeOf(Checkout).apply(this, arguments));\n  }\n\n  _createClass(Checkout, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this$props = this.props,\n          order = _this$props.order,\n          actions = _this$props.actions,\n          history = _this$props.history,\n          params = _this$props.match.params;\n\n      if (!order || !order.length) {\n        return history.push(this.getRestaurantLink());\n      }\n\n      actions.getRestaurantForClient(params.restaurant_url);\n    }\n  }, {\n    key: \"handleRemoveOrderItemClick\",\n    value: function handleRemoveOrderItemClick(_ref) {\n      var uuid = _ref.uuid;\n      var actions = this.props.actions;\n      actions.removeItemFromCheckout(uuid);\n    }\n  }, {\n    key: \"onPaymentDetailsSubmit\",\n    value: function onPaymentDetailsSubmit(paymentDetails) {\n      var actions = this.props.actions;\n      actions.createOrderFromCheckout({\n        paymentDetails: paymentDetails\n      });\n    }\n  }, {\n    key: \"getRestaurantLink\",\n    value: function getRestaurantLink() {\n      var params = this.props.match.params;\n      return \"/r/\".concat(params.restaurant_url);\n    }\n  }, {\n    key: \"onBackToMenuClick\",\n    value: function onBackToMenuClick() {\n      var actions = this.props.actions;\n      actions.backToRestaurantMenu(this.getRestaurantLink());\n    }\n  }, {\n    key: \"handleEditOrderItemClick\",\n    value: function handleEditOrderItemClick(item) {\n      var actions = this.props.actions;\n      actions.setDishOrderModal({\n        open: true,\n        isEditing: true,\n        id: item.uuid\n      });\n    }\n  }, {\n    key: \"getStepContent\",\n    value: function getStepContent(step) {\n      var _this$props2 = this.props,\n          params = _this$props2.match.params,\n          actions = _this$props2.actions,\n          totalPrice = _this$props2.totalPrice,\n          order = _this$props2.order;\n\n      switch (step) {\n        case 0:\n          {\n            return React.createElement(ReviewOrderTab, {\n              totalPrice: totalPrice,\n              canNextStep: !!order.length,\n              order: order,\n              restaurant_url: params.restaurant_url,\n              handleNextStep: actions.handleNextStep,\n              restaurantLink: this.getRestaurantLink(),\n              handleRemoveOrderItemClick: this.handleRemoveOrderItemClick,\n              handleEditOrderItemClick: this.handleEditOrderItemClick,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 175\n              },\n              __self: this\n            });\n          }\n\n        case 1:\n          {\n            return React.createElement(PaymentDetailsTab, Object.assign({}, HelperService.pick(this.props, ['isOrderCreating', 'restaurant', 'order']), {\n              onSubmit: this.onPaymentDetailsSubmit,\n              orderPriceInCoins: CurrencyService.toCoins(totalPrice.total),\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 189\n              },\n              __self: this\n            }));\n          }\n\n        case 2:\n          {\n            return React.createElement(OrderPlacedTab, {\n              onBackToMenuClick: this.onBackToMenuClick,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 201\n              },\n              __self: this\n            });\n          }\n\n        default:\n          {\n            return null;\n          }\n      }\n    }\n  }, {\n    key: \"mapSteps\",\n    value: function mapSteps() {\n      return checkoutStepsNames.map(function (label) {\n        return React.createElement(Step, {\n          key: label,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 211\n          },\n          __self: this\n        }, React.createElement(StepLabel, {\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 212\n          },\n          __self: this\n        }, label));\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props3 = this.props,\n          restaurantLoading = _this$props3.restaurantLoading,\n          activeStep = _this$props3.activeStep;\n      return React.createElement(\"div\", {\n        className: \"checkout-container app-static-container\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, React.createElement(CheckoutChangeListener, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 222\n        },\n        __self: this\n      }), React.createElement(Stepper, {\n        alternativeLabel: true,\n        nonLinear: true,\n        activeStep: activeStep,\n        className: \"order-stepper\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      }, this.mapSteps()), restaurantLoading ? React.createElement(Preloader, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 230\n        },\n        __self: this\n      }) : this.getStepContent(activeStep));\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n\n  return Checkout;\n}(PureComponent), _class3.propTypes = {\n  orderForPayment: PropTypes.array,\n  order: PropTypes.array,\n  setDishExtra: PropTypes.func,\n  removeDishExtra: PropTypes.func,\n  setDishSize: PropTypes.func,\n  removeDish: PropTypes.func,\n  restaurant: PropTypes.string,\n  restaurantLink: PropTypes.string,\n  totalPrice: PropTypes.object,\n  orderLoading: PropTypes.bool,\n  createOrder: PropTypes.func,\n  removeDishFromOrder: PropTypes.func\n}, _temp), (_applyDecoratedDescriptor(_class2.prototype, \"handleRemoveOrderItemClick\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"handleRemoveOrderItemClick\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onPaymentDetailsSubmit\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onPaymentDetailsSubmit\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onBackToMenuClick\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onBackToMenuClick\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"handleEditOrderItemClick\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"handleEditOrderItemClick\"), _class2.prototype)), _class2)) || _class);\nexport { Checkout as default };\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Checkout/Checkout.js\");\n  reactHotLoader.register(mergeProps, \"mergeProps\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Checkout/Checkout.js\");\n  reactHotLoader.register(Checkout, \"Checkout\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Checkout/Checkout.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/scenes/Checkout/Checkout.js"],"names":["React","PureComponent","Stepper","Step","StepLabel","PropTypes","connect","bindActionCreators","autobind","HelperService","CurrencyService","Preloader","checkoutStepsNames","OrderPlacedTab","PaymentDetailsTab","ReviewOrderTab","isRestaurantsLoadingSelector","managedRestaurantSelector","getRestaurantForClient","createOrder","orderIsLoadingSelector","createOrderFromCheckout","isStripeChargeLoadingSelector","activeCheckoutStepSelector","checkoutItemsSelector","totalPriceSelector","clearCheckout","setCheckoutUi","backToRestaurantMenu","removeItemFromCheckout","removeDish","setDishOrderModal","CheckoutChangeListener","mapStateToProps","state","order","totalPrice","isOrderCreating","restaurantLoading","restaurant","activeStep","mergeProps","stateProps","dispatchProps","ownProps","dispatch","nextStep","actions","handleNextStep","Checkout","props","history","params","match","length","push","getRestaurantLink","restaurant_url","uuid","paymentDetails","item","open","isEditing","id","step","handleRemoveOrderItemClick","handleEditOrderItemClick","pick","onPaymentDetailsSubmit","toCoins","total","onBackToMenuClick","map","label","mapSteps","getStepContent","propTypes","orderForPayment","array","setDishExtra","func","removeDishExtra","setDishSize","string","restaurantLink","object","orderLoading","bool","removeDishFromOrder"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,QAAqC,OAArC;AACA,OAAOC,OAAP,MAAoB,2BAApB;AACA,OAAOC,IAAP,MAAiB,wBAAjB;AACA,OAAOC,SAAP,MAAsB,6BAAtB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,kBAAT,QAAmC,OAAnC;AACA,SAASC,QAAT,QAAyB,iBAAzB;AAEA,SAASC,aAAT,EAAwBC,eAAxB,QAA+C,gBAA/C;AACA,SAASC,SAAT,QAA0B,kBAA1B;AACA,SAASC,kBAAT,QAAmC,2CAAnC;AAEA,SACEC,cADF,EAEEC,iBAFF,EAGEC,cAHF,QAIO,cAJP;AAKA,SACEC,4BADF,EAEEC,yBAFF,EAGEC,sBAHF,QAIO,2BAJP;AAMA,SACEC,WADF,EAEE;AACAC,sBAHF,EAIEC,uBAJF,QAKO,sBALP;AAOA,SACEC,6BADF,EAEEC,0BAFF,EAGEC,qBAHF,EAIEC,kBAJF,EAKEC,aALF,EAMEC,aANF,EAOEC,oBAPF,EAQEC,sBARF,QASO,wBATP;AAWA,SAASC,UAAT,QAA2B,sBAA3B;AAEA,SAASC,iBAAT,QAAkC,iCAAlC;AAEA,SAASC,sBAAT,QAAuC,2BAAvC;;AAEA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAAAC,KAAK;AAAA,SAAK;AAChCC,IAAAA,KAAK,EAAEX,qBAAqB,CAACU,KAAD,CADI;AAEhCE,IAAAA,UAAU,EAAEX,kBAAkB,CAACS,KAAD,CAFE;AAGhCG,IAAAA,eAAe,EACbjB,sBAAsB,CAACc,KAAD,CAAtB,IAAiCZ,6BAA6B,CAACY,KAAD,CAJhC;AAKhCI,IAAAA,iBAAiB,EAAEtB,4BAA4B,CAACkB,KAAD,CALf;AAMhCK,IAAAA,UAAU,EAAEtB,yBAAyB,CAACiB,KAAD,CANL;AAOhCM,IAAAA,UAAU,EAAEjB,0BAA0B,CAACW,KAAD;AAPN,GAAL;AAAA,CAA7B;;AAUA,IAAMO,UAAU,GAAG,SAAbA,UAAa,CAACC,UAAD,EAAaC,aAAb,EAA4BC,QAA5B,EAAyC;AAAA,MAClDC,QADkD,GACrCF,aADqC,CAClDE,QADkD;AAAA,MAElDL,UAFkD,GAEnCE,UAFmC,CAElDF,UAFkD;AAG1D,MAAMM,QAAQ,GAAGN,UAAU,GAAG,CAA9B;AAEA,2BACKE,UADL,EAEKC,aAFL,EAGKC,QAHL;AAKEG,IAAAA,OAAO;AACLC,MAAAA,cAAc,EAAE;AAAA,eAAMH,QAAQ,CAAClB,aAAa,CAAC;AAAEa,UAAAA,UAAU,EAAEM;AAAd,SAAD,CAAd,CAAd;AAAA;AADX,OAGFvC,kBAAkB,CACnB;AACEwB,MAAAA,iBAAiB,EAAjBA,iBADF;AAGED,MAAAA,UAAU,EAAVA,UAHF;AAIEX,MAAAA,WAAW,EAAXA,WAJF;AAKEO,MAAAA,aAAa,EAAbA,aALF;AAMEL,MAAAA,uBAAuB,EAAvBA,uBANF;AAOEH,MAAAA,sBAAsB,EAAtBA,sBAPF;AAQEW,MAAAA,sBAAsB,EAAtBA,sBARF;AASED,MAAAA,oBAAoB,EAApBA;AATF,KADmB,EAYnBiB,QAZmB,CAHhB;AALT;AAwBD,CA7BD;;IAqCMI,Q,WALL3C,OAAO,CACN2B,eADM,EAEN,IAFM,EAGNQ,UAHM,C;;;;;;;;;;;;;wCAqBc;AAAA,wBAMd,KAAKS,KANS;AAAA,UAEhBf,KAFgB,eAEhBA,KAFgB;AAAA,UAGhBY,OAHgB,eAGhBA,OAHgB;AAAA,UAIhBI,OAJgB,eAIhBA,OAJgB;AAAA,UAKPC,MALO,eAKhBC,KALgB,CAKPD,MALO;;AAQlB,UAAI,CAACjB,KAAD,IAAU,CAACA,KAAK,CAACmB,MAArB,EAA6B;AAC3B,eAAOH,OAAO,CAACI,IAAR,CAAa,KAAKC,iBAAL,EAAb,CAAP;AACD;;AAEDT,MAAAA,OAAO,CAAC7B,sBAAR,CAA+BkC,MAAM,CAACK,cAAtC;AACD;;;qDAGoC;AAAA,UAARC,IAAQ,QAARA,IAAQ;AAAA,UAC3BX,OAD2B,GACf,KAAKG,KADU,CAC3BH,OAD2B;AAEnCA,MAAAA,OAAO,CAAClB,sBAAR,CAA+B6B,IAA/B;AACD;;;2CAGsBC,c,EAAgB;AAAA,UAC7BZ,OAD6B,GACjB,KAAKG,KADY,CAC7BH,OAD6B;AAErCA,MAAAA,OAAO,CAAC1B,uBAAR,CAAgC;AAAEsC,QAAAA,cAAc,EAAdA;AAAF,OAAhC;AACD;;;wCAEmB;AAAA,UAEPP,MAFO,GAGd,KAAKF,KAHS,CAEhBG,KAFgB,CAEPD,MAFO;AAKlB,0BAAaA,MAAM,CAACK,cAApB;AACD;;;wCAGmB;AAAA,UACVV,OADU,GACE,KAAKG,KADP,CACVH,OADU;AAElBA,MAAAA,OAAO,CAACnB,oBAAR,CAA6B,KAAK4B,iBAAL,EAA7B;AACD;;;6CAGwBI,I,EAAM;AAAA,UACrBb,OADqB,GACT,KAAKG,KADI,CACrBH,OADqB;AAG7BA,MAAAA,OAAO,CAAChB,iBAAR,CAA0B;AACxB8B,QAAAA,IAAI,EAAE,IADkB;AAExBC,QAAAA,SAAS,EAAE,IAFa;AAGxBC,QAAAA,EAAE,EAAEH,IAAI,CAACF;AAHe,OAA1B;AAKD;;;mCAEcM,I,EAAM;AAAA,yBAMf,KAAKd,KANU;AAAA,UAERE,MAFQ,gBAEjBC,KAFiB,CAERD,MAFQ;AAAA,UAGjBL,OAHiB,gBAGjBA,OAHiB;AAAA,UAIjBX,UAJiB,gBAIjBA,UAJiB;AAAA,UAKjBD,KALiB,gBAKjBA,KALiB;;AAQnB,cAAQ6B,IAAR;AACE,aAAK,CAAL;AAAQ;AACN,mBACE,oBAAC,cAAD;AACE,cAAA,UAAU,EAAE5B,UADd;AAEE,cAAA,WAAW,EAAE,CAAC,CAACD,KAAK,CAACmB,MAFvB;AAGE,cAAA,KAAK,EAAEnB,KAHT;AAIE,cAAA,cAAc,EAAEiB,MAAM,CAACK,cAJzB;AAKE,cAAA,cAAc,EAAEV,OAAO,CAACC,cAL1B;AAME,cAAA,cAAc,EAAE,KAAKQ,iBAAL,EANlB;AAOE,cAAA,0BAA0B,EAAE,KAAKS,0BAPnC;AAQE,cAAA,wBAAwB,EAAE,KAAKC,wBARjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cADF;AAYD;;AACD,aAAK,CAAL;AAAQ;AACN,mBACE,oBAAC,iBAAD,oBACMzD,aAAa,CAAC0D,IAAd,CAAmB,KAAKjB,KAAxB,EAA+B,CACjC,iBADiC,EAEjC,YAFiC,EAGjC,OAHiC,CAA/B,CADN;AAME,cAAA,QAAQ,EAAE,KAAKkB,sBANjB;AAOE,cAAA,iBAAiB,EAAE1D,eAAe,CAAC2D,OAAhB,CAAwBjC,UAAU,CAACkC,KAAnC,CAPrB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eADF;AAWD;;AACD,aAAK,CAAL;AAAQ;AACN,mBAAO,oBAAC,cAAD;AAAgB,cAAA,iBAAiB,EAAE,KAAKC,iBAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;AACD;;AACD;AAAS;AACP,mBAAO,IAAP;AACD;AAjCH;AAmCD;;;+BAEU;AACT,aAAO3D,kBAAkB,CAAC4D,GAAnB,CAAuB,UAAAC,KAAK;AAAA,eACjC,oBAAC,IAAD;AAAM,UAAA,GAAG,EAAEA,KAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WACE,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,WAAYA,KAAZ,CADF,CADiC;AAAA,OAA5B,CAAP;AAKD;;;6BAEQ;AAAA,yBACmC,KAAKvB,KADxC;AAAA,UACCZ,iBADD,gBACCA,iBADD;AAAA,UACoBE,UADpB,gBACoBA,UADpB;AAGP,aACE;AAAK,QAAA,SAAS,EAAC,yCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACE,oBAAC,sBAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QADF,EAEE,oBAAC,OAAD;AACE,QAAA,gBAAgB,MADlB;AAEE,QAAA,SAAS,MAFX;AAGE,QAAA,UAAU,EAAEA,UAHd;AAIE,QAAA,SAAS,EAAC,eAJZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAKG,KAAKkC,QAAL,EALH,CAFF,EASGpC,iBAAiB,GAAG,oBAAC,SAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAAH,GAAmB,KAAKqC,cAAL,CAAoBnC,UAApB,CATvC,CADF;AAaD;;;;;;;;;;;EAzIoBvC,a,WACd2E,S,GAAY;AACjBC,EAAAA,eAAe,EAAExE,SAAS,CAACyE,KADV;AAEjB3C,EAAAA,KAAK,EAAE9B,SAAS,CAACyE,KAFA;AAGjBC,EAAAA,YAAY,EAAE1E,SAAS,CAAC2E,IAHP;AAIjBC,EAAAA,eAAe,EAAE5E,SAAS,CAAC2E,IAJV;AAKjBE,EAAAA,WAAW,EAAE7E,SAAS,CAAC2E,IALN;AAMjBlD,EAAAA,UAAU,EAAEzB,SAAS,CAAC2E,IANL;AAOjBzC,EAAAA,UAAU,EAAElC,SAAS,CAAC8E,MAPL;AAQjBC,EAAAA,cAAc,EAAE/E,SAAS,CAAC8E,MART;AASjB/C,EAAAA,UAAU,EAAE/B,SAAS,CAACgF,MATL;AAUjBC,EAAAA,YAAY,EAAEjF,SAAS,CAACkF,IAVP;AAWjBpE,EAAAA,WAAW,EAAEd,SAAS,CAAC2E,IAXN;AAYjBQ,EAAAA,mBAAmB,EAAEnF,SAAS,CAAC2E;AAZd,C,uFA8BlBxE,Q,iLAMAA,Q,wKAcAA,Q,0KAMAA,Q;SAzDGyC,Q;;;;;;;;;;0BA/CAhB,e;0BAUAQ,U;0BAqCAQ,Q","sourcesContent":["import React, { PureComponent } from 'react';\nimport Stepper from '@material-ui/core/Stepper';\nimport Step from '@material-ui/core/Step';\nimport StepLabel from '@material-ui/core/StepLabel';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\nimport { autobind } from 'core-decorators';\n\nimport { HelperService, CurrencyService } from '../../services';\nimport { Preloader } from '../../components';\nimport { checkoutStepsNames } from '../../modules/checkout/checkout.constants';\n\nimport {\n  OrderPlacedTab,\n  PaymentDetailsTab,\n  ReviewOrderTab,\n} from './components';\nimport {\n  isRestaurantsLoadingSelector,\n  managedRestaurantSelector,\n  getRestaurantForClient,\n} from '../../modules/restaurants';\n\nimport {\n  createOrder,\n  // abortPageRequests,\n  orderIsLoadingSelector,\n  createOrderFromCheckout,\n} from '../../modules/orders';\n\nimport {\n  isStripeChargeLoadingSelector,\n  activeCheckoutStepSelector,\n  checkoutItemsSelector,\n  totalPriceSelector,\n  clearCheckout,\n  setCheckoutUi,\n  backToRestaurantMenu,\n  removeItemFromCheckout,\n} from '../../modules/checkout';\n\nimport { removeDish } from '../../modules/dishes';\n\nimport { setDishOrderModal } from '../../modules/modals/dish-order';\n\nimport { CheckoutChangeListener } from '../CheckoutChangeListener';\n\nconst mapStateToProps = state => ({\n  order: checkoutItemsSelector(state),\n  totalPrice: totalPriceSelector(state),\n  isOrderCreating:\n    orderIsLoadingSelector(state) || isStripeChargeLoadingSelector(state),\n  restaurantLoading: isRestaurantsLoadingSelector(state),\n  restaurant: managedRestaurantSelector(state),\n  activeStep: activeCheckoutStepSelector(state),\n});\n\nconst mergeProps = (stateProps, dispatchProps, ownProps) => {\n  const { dispatch } = dispatchProps;\n  const { activeStep } = stateProps;\n  const nextStep = activeStep + 1;\n\n  return {\n    ...stateProps,\n    ...dispatchProps,\n    ...ownProps,\n\n    actions: {\n      handleNextStep: () => dispatch(setCheckoutUi({ activeStep: nextStep })),\n\n      ...bindActionCreators(\n        {\n          setDishOrderModal,\n\n          removeDish,\n          createOrder,\n          clearCheckout,\n          createOrderFromCheckout,\n          getRestaurantForClient,\n          removeItemFromCheckout,\n          backToRestaurantMenu,\n        },\n        dispatch,\n      ),\n    },\n  };\n};\n\nexport default\n@connect(\n  mapStateToProps,\n  null,\n  mergeProps,\n)\nclass Checkout extends PureComponent {\n  static propTypes = {\n    orderForPayment: PropTypes.array,\n    order: PropTypes.array,\n    setDishExtra: PropTypes.func,\n    removeDishExtra: PropTypes.func,\n    setDishSize: PropTypes.func,\n    removeDish: PropTypes.func,\n    restaurant: PropTypes.string,\n    restaurantLink: PropTypes.string,\n    totalPrice: PropTypes.object,\n    orderLoading: PropTypes.bool,\n    createOrder: PropTypes.func,\n    removeDishFromOrder: PropTypes.func,\n  };\n\n  componentDidMount() {\n    const {\n      order,\n      actions,\n      history,\n      match: { params },\n    } = this.props;\n\n    if (!order || !order.length) {\n      return history.push(this.getRestaurantLink());\n    }\n\n    actions.getRestaurantForClient(params.restaurant_url);\n  }\n\n  @autobind\n  handleRemoveOrderItemClick({ uuid }) {\n    const { actions } = this.props;\n    actions.removeItemFromCheckout(uuid);\n  }\n\n  @autobind\n  onPaymentDetailsSubmit(paymentDetails) {\n    const { actions } = this.props;\n    actions.createOrderFromCheckout({ paymentDetails });\n  }\n\n  getRestaurantLink() {\n    const {\n      match: { params },\n    } = this.props;\n\n    return `/r/${params.restaurant_url}`;\n  }\n\n  @autobind\n  onBackToMenuClick() {\n    const { actions } = this.props;\n    actions.backToRestaurantMenu(this.getRestaurantLink());\n  }\n\n  @autobind\n  handleEditOrderItemClick(item) {\n    const { actions } = this.props;\n\n    actions.setDishOrderModal({\n      open: true,\n      isEditing: true,\n      id: item.uuid,\n    });\n  }\n\n  getStepContent(step) {\n    const {\n      match: { params },\n      actions,\n      totalPrice,\n      order,\n    } = this.props;\n\n    switch (step) {\n      case 0: {\n        return (\n          <ReviewOrderTab\n            totalPrice={totalPrice}\n            canNextStep={!!order.length}\n            order={order}\n            restaurant_url={params.restaurant_url}\n            handleNextStep={actions.handleNextStep}\n            restaurantLink={this.getRestaurantLink()}\n            handleRemoveOrderItemClick={this.handleRemoveOrderItemClick}\n            handleEditOrderItemClick={this.handleEditOrderItemClick}\n          />\n        );\n      }\n      case 1: {\n        return (\n          <PaymentDetailsTab\n            {...HelperService.pick(this.props, [\n              'isOrderCreating',\n              'restaurant',\n              'order',\n            ])}\n            onSubmit={this.onPaymentDetailsSubmit}\n            orderPriceInCoins={CurrencyService.toCoins(totalPrice.total)}\n          />\n        );\n      }\n      case 2: {\n        return <OrderPlacedTab onBackToMenuClick={this.onBackToMenuClick} />;\n      }\n      default: {\n        return null;\n      }\n    }\n  }\n\n  mapSteps() {\n    return checkoutStepsNames.map(label => (\n      <Step key={label}>\n        <StepLabel>{label}</StepLabel>\n      </Step>\n    ));\n  }\n\n  render() {\n    const { restaurantLoading, activeStep } = this.props;\n\n    return (\n      <div className=\"checkout-container app-static-container\">\n        <CheckoutChangeListener />\n        <Stepper\n          alternativeLabel\n          nonLinear\n          activeStep={activeStep}\n          className=\"order-stepper\">\n          {this.mapSteps()}\n        </Stepper>\n        {restaurantLoading ? <Preloader /> : this.getStepContent(activeStep)}\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}