{"ast":null,"code":"import _objectSpread from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _regeneratorRuntime from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _applyDecoratedDescriptor from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/applyDecoratedDescriptor\";\nimport _toConsumableArray from \"/home/vladimir/workspace/bestonlinemenus-front.loc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _dec,\n    _dec2,\n    _class,\n    _class2,\n    _jsxFileName = \"/home/vladimir/workspace/bestonlinemenus-front.loc/src/scenes/Designer/Designer.js\";\n\n(function () {\n  var enterModule = require('react-hot-loader').enterModule;\n\n  enterModule && enterModule(module);\n})();\n\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { reduxForm, formValueSelector } from 'redux-form';\nimport DocumentTitle from 'react-document-title';\nimport { connect } from 'react-redux';\nimport { HelperService } from '/services';\nimport { autobind } from 'core-decorators';\nimport { DesignerForm, DesignerPreview } from './components';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport { AppCleanHOC } from '/components';\nimport { loadingsSelector, initialValuesSelector, abortPageRequests, getDesignerById, updateDesigner, designerValidation, formFieldNamesSelector } from './modules';\nimport './Designer.scss';\nvar formFieldsSelector = formValueSelector('Designer');\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return {\n    loading: loadingsSelector(state),\n    initialValues: initialValuesSelector(state),\n    formValues: formFieldsSelector.apply(void 0, [state].concat(_toConsumableArray(formFieldNamesSelector())))\n  };\n};\n\nvar mapDispatchToProps = {\n  abortPageRequests: abortPageRequests,\n  getDesignerById: getDesignerById,\n  updateDesigner: updateDesigner,\n  designerValidation: designerValidation\n};\nvar Designer = (_dec = connect(mapStateToProps, mapDispatchToProps), _dec2 = reduxForm({\n  form: 'Designer',\n  enableReinitialize: true,\n  validate: designerValidation\n}), _dec(_class = _dec2(_class = AppCleanHOC(_class = (_class2 =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(Designer, _Component);\n\n  function Designer() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, Designer);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(Designer)).call.apply(_getPrototypeOf2, [this].concat(args)));\n    _this.state = {\n      activeTab: 0,\n      logoPixelCrop: {},\n      background_picturePixelCrop: {},\n      logoCrop: {\n        x: 0,\n        y: 0,\n        width: 30,\n        height: 30\n      },\n      background_pictureCrop: {\n        x: 0,\n        y: 0,\n        width: 30,\n        height: 30\n      }\n    };\n    return _this;\n  }\n\n  _createClass(Designer, [{\n    key: \"getCroppedImages\",\n    value: function () {\n      var _getCroppedImages = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee(_ref) {\n        var logo, background_picture, _this$state, logoPixelCrop, background_picturePixelCrop, croppedLogo, corppedBgImage;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                logo = _ref.logo, background_picture = _ref.background_picture;\n                _this$state = this.state, logoPixelCrop = _this$state.logoPixelCrop, background_picturePixelCrop = _this$state.background_picturePixelCrop;\n                croppedLogo = logo;\n                corppedBgImage = background_picture;\n\n                if (!(typeof logo !== 'string')) {\n                  _context.next = 8;\n                  break;\n                }\n\n                _context.next = 7;\n                return HelperService.getCroppedImg({\n                  file: logo,\n                  pixelCrop: logoPixelCrop\n                });\n\n              case 7:\n                croppedLogo = _context.sent;\n\n              case 8:\n                if (!(typeof background_picture !== 'string')) {\n                  _context.next = 12;\n                  break;\n                }\n\n                _context.next = 11;\n                return HelperService.getCroppedImg({\n                  file: background_picture,\n                  pixelCrop: background_picturePixelCrop\n                });\n\n              case 11:\n                corppedBgImage = _context.sent;\n\n              case 12:\n                return _context.abrupt(\"return\", {\n                  logo: croppedLogo,\n                  background_picture: corppedBgImage\n                });\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      return function getCroppedImages(_x) {\n        return _getCroppedImages.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"onUpdateCLick\",\n    value: function () {\n      var _onUpdateCLick = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2(event) {\n        var _this$props, formValues, updateDesigner, _this$props$formValue, logo, background_picture, _this$getSearch, restaurant_id, _ref2, body;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this$props = this.props, formValues = _this$props.formValues, updateDesigner = _this$props.updateDesigner, _this$props$formValue = _this$props.formValues;\n                _this$props$formValue = _this$props$formValue === void 0 ? {} : _this$props$formValue;\n                logo = _this$props$formValue.logo, background_picture = _this$props$formValue.background_picture;\n                _this$getSearch = this.getSearch(), restaurant_id = _this$getSearch.restaurant_id;\n                event.preventDefault();\n                _context2.next = 7;\n                return this.getCroppedImages({\n                  logo: logo,\n                  background_picture: background_picture\n                });\n\n              case 7:\n                _ref2 = _context2.sent;\n                logo = _ref2.logo;\n                background_picture = _ref2.background_picture;\n                body = _objectSpread({}, formValues, {\n                  restaurant_id: restaurant_id\n                });\n                delete body.restaurant_name;\n\n                if (typeof logo !== 'string') {\n                  body.logo = logo;\n                }\n\n                if (typeof background_picture !== 'string') {\n                  body.background_picture = background_picture;\n                }\n\n                updateDesigner({\n                  body: body\n                });\n\n              case 15:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      return function onUpdateCLick(_x2) {\n        return _onUpdateCLick.apply(this, arguments);\n      };\n    }()\n  }, {\n    key: \"onLogoCrop\",\n    value: function onLogoCrop(crop, pixelCrop) {\n      this.setState({\n        logoCrop: crop,\n        logoPixelCrop: pixelCrop\n      });\n    }\n  }, {\n    key: \"onBackgroundCrop\",\n    value: function onBackgroundCrop(crop, pixelCrop) {\n      this.setState({\n        background_pictureCrop: crop,\n        background_picturePixelCrop: pixelCrop\n      });\n    }\n  }, {\n    key: \"onDropLogo\",\n    value: function onDropLogo(accepted) {\n      var change = this.props.change;\n      change('logo', accepted);\n    }\n  }, {\n    key: \"onDropBackgroundImage\",\n    value: function onDropBackgroundImage(accepted) {\n      var change = this.props.change;\n      change('background_picture', accepted);\n    }\n  }, {\n    key: \"onChangeTab\",\n    value: function onChangeTab(event, activeTab) {\n      this.setState({\n        activeTab: activeTab\n      });\n    }\n  }, {\n    key: \"getSearch\",\n    value: function getSearch() {\n      var search = this.props.location.search;\n      return HelperService.parseSearch(search);\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var getDesignerById = this.props.getDesignerById;\n\n      var _this$getSearch2 = this.getSearch(),\n          restaurant_id = _this$getSearch2.restaurant_id;\n\n      getDesignerById({\n        body: {\n          restaurant_id: restaurant_id\n        }\n      });\n    }\n  }, {\n    key: \"getPreviews\",\n    value: function getPreviews() {\n      var _this$props$formValue2 = this.props.formValues;\n      _this$props$formValue2 = _this$props$formValue2 === void 0 ? {} : _this$props$formValue2;\n      var logo = _this$props$formValue2.logo,\n          background_picture = _this$props$formValue2.background_picture;\n      var logoForPreview = logo instanceof File || logo instanceof Blob ? URL.createObjectURL(logo) : logo;\n      var bgForPreview = background_picture instanceof File || background_picture instanceof Blob ? URL.createObjectURL(background_picture) : background_picture;\n      return {\n        logo: logoForPreview,\n        background_picture: bgForPreview\n      };\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$state2 = this.state,\n          activeTab = _this$state2.activeTab,\n          background_pictureCrop = _this$state2.background_pictureCrop,\n          logoCrop = _this$state2.logoCrop;\n      var _this$props$formValue3 = this.props.formValues,\n          logo = _this$props$formValue3.logo,\n          url = _this$props$formValue3.url,\n          background_picture = _this$props$formValue3.background_picture,\n          restaurant_name = _this$props$formValue3.restaurant_name;\n      return React.createElement(DocumentTitle, {\n        title: \"Page designer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 207\n        },\n        __self: this\n      }, React.createElement(\"div\", {\n        className: 'app-static-container designer',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 208\n        },\n        __self: this\n      }, React.createElement(\"h1\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 209\n        },\n        __self: this\n      }, \"Restaurant page designer\"), React.createElement(Tabs, {\n        value: activeTab,\n        indicatorColor: 'primary',\n        className: 'designer__tabs',\n        onChange: this.onChangeTab,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 211\n        },\n        __self: this\n      }, React.createElement(Tab, {\n        label: \"Configuration\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }), React.createElement(Tab, {\n        label: \"Restaurant header preview\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 218\n        },\n        __self: this\n      })), React.createElement(\"div\", {\n        className: 'designer__tabs-content',\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 221\n        },\n        __self: this\n      }, activeTab === 0 && React.createElement(DesignerForm, Object.assign({\n        background_pictureCrop: background_pictureCrop,\n        logoCrop: logoCrop,\n        logo: logo,\n        background_picture: background_picture,\n        url: url\n      }, {\n        onDropBackgroundImage: this.onDropBackgroundImage,\n        onDropLogo: this.onDropLogo,\n        onBackgroundCrop: this.onBackgroundCrop,\n        onLogoCrop: this.onLogoCrop,\n        onUpdateCLick: this.onUpdateCLick\n      }, HelperService.pick(this.props, ['loading', 'invalid', 'change']), {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 223\n        },\n        __self: this\n      })), activeTab === 1 && React.createElement(DesignerPreview, Object.assign({}, this.getPreviews(), {\n        name: restaurant_name,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      })))));\n    }\n  }, {\n    key: \"__reactstandin__regenerateByEval\",\n    // @ts-ignore\n    value: function __reactstandin__regenerateByEval(key, code) {\n      // @ts-ignore\n      this[key] = eval(code);\n    }\n  }]);\n\n  return Designer;\n}(Component), (_applyDecoratedDescriptor(_class2.prototype, \"onUpdateCLick\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onUpdateCLick\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onLogoCrop\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onLogoCrop\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onBackgroundCrop\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onBackgroundCrop\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onDropLogo\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onDropLogo\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onDropBackgroundImage\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onDropBackgroundImage\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"onChangeTab\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"onChangeTab\"), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, \"getPreviews\", [autobind], Object.getOwnPropertyDescriptor(_class2.prototype, \"getPreviews\"), _class2.prototype)), _class2)) || _class) || _class) || _class);\nexport { Designer as default };\nDesigner.propTypes = {\n  abortPageRequests: PropTypes.func\n};\nDesigner.defaultProps = {};\n;\n\n(function () {\n  var reactHotLoader = require('react-hot-loader').default;\n\n  var leaveModule = require('react-hot-loader').leaveModule;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(formFieldsSelector, \"formFieldsSelector\", \"/home/vladimir/workspace/bestonlinemenus-front.loc/src/scenes/Designer/Designer.js\");\n  reactHotLoader.register(mapStateToProps, \"mapStateToProps\", \"/home/vladimir/workspace/bestonlinemenus-front.loc/src/scenes/Designer/Designer.js\");\n  reactHotLoader.register(mapDispatchToProps, \"mapDispatchToProps\", \"/home/vladimir/workspace/bestonlinemenus-front.loc/src/scenes/Designer/Designer.js\");\n  reactHotLoader.register(Designer, \"Designer\", \"/home/vladimir/workspace/bestonlinemenus-front.loc/src/scenes/Designer/Designer.js\");\n  leaveModule(module);\n})();\n\n;","map":{"version":3,"sources":["/home/vladimir/workspace/bestonlinemenus-front.loc/src/scenes/Designer/Designer.js"],"names":["React","Component","PropTypes","reduxForm","formValueSelector","DocumentTitle","connect","HelperService","autobind","DesignerForm","DesignerPreview","Tabs","Tab","AppCleanHOC","loadingsSelector","initialValuesSelector","abortPageRequests","getDesignerById","updateDesigner","designerValidation","formFieldNamesSelector","formFieldsSelector","mapStateToProps","state","loading","initialValues","formValues","mapDispatchToProps","Designer","form","enableReinitialize","validate","activeTab","logoPixelCrop","background_picturePixelCrop","logoCrop","x","y","width","height","background_pictureCrop","logo","background_picture","croppedLogo","corppedBgImage","getCroppedImg","file","pixelCrop","event","props","getSearch","restaurant_id","preventDefault","getCroppedImages","body","restaurant_name","crop","setState","accepted","change","search","location","parseSearch","logoForPreview","File","Blob","URL","createObjectURL","bgForPreview","url","onChangeTab","onDropBackgroundImage","onDropLogo","onBackgroundCrop","onLogoCrop","onUpdateCLick","pick","getPreviews","propTypes","func","defaultProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,SAAT,EAAoBC,iBAApB,QAA6C,YAA7C;AACA,OAAOC,aAAP,MAA0B,sBAA1B;AACA,SAASC,OAAT,QAAwB,aAAxB;AACA,SAASC,aAAT,QAA8B,WAA9B;AAEA,SAASC,QAAT,QAAyB,iBAAzB;AAEA,SAASC,YAAT,EAAuBC,eAAvB,QAA8C,cAA9C;AACA,OAAOC,IAAP,MAAiB,wBAAjB;AACA,OAAOC,GAAP,MAAgB,uBAAhB;AAEA,SAASC,WAAT,QAA4B,aAA5B;AAEA,SACIC,gBADJ,EAEIC,qBAFJ,EAGIC,iBAHJ,EAIIC,eAJJ,EAKIC,cALJ,EAMIC,kBANJ,EAOIC,sBAPJ,QAQO,WARP;AAUA,OAAO,iBAAP;AAEA,IAAMC,kBAAkB,GAAGjB,iBAAiB,CAAC,UAAD,CAA5C;;AAEA,IAAMkB,eAAe,GAAG,SAAlBA,eAAkB,CAAAC,KAAK;AAAA,SAAK;AAC9BC,IAAAA,OAAO,EAAEV,gBAAgB,CAACS,KAAD,CADK;AAE9BE,IAAAA,aAAa,EAAEV,qBAAqB,CAACQ,KAAD,CAFN;AAG9BG,IAAAA,UAAU,EAAEL,kBAAkB,MAAlB,UAAmBE,KAAnB,4BAA6BH,sBAAsB,EAAnD;AAHkB,GAAL;AAAA,CAA7B;;AAMA,IAAMO,kBAAkB,GAAG;AACvBX,EAAAA,iBAAiB,EAAjBA,iBADuB;AAEvBC,EAAAA,eAAe,EAAfA,eAFuB;AAGvBC,EAAAA,cAAc,EAAdA,cAHuB;AAIvBC,EAAAA,kBAAkB,EAAlBA;AAJuB,CAA3B;IAkBMS,Q,WAVLtB,OAAO,CACJgB,eADI,EAEJK,kBAFI,C,UAIPxB,SAAS,CAAC;AACP0B,EAAAA,IAAI,EAAE,UADC;AAEPC,EAAAA,kBAAkB,EAAE,IAFb;AAGPC,EAAAA,QAAQ,EAAEZ;AAHH,CAAD,C,+BAKTN,W;;;;;;;;;;;;;;;;;UAEGU,K,GAAQ;AACJS,MAAAA,SAAS,EAAE,CADP;AAEJC,MAAAA,aAAa,EAAE,EAFX;AAGJC,MAAAA,2BAA2B,EAAE,EAHzB;AAIJC,MAAAA,QAAQ,EAAE;AACNC,QAAAA,CAAC,EAAE,CADG;AAENC,QAAAA,CAAC,EAAE,CAFG;AAGNC,QAAAA,KAAK,EAAE,EAHD;AAINC,QAAAA,MAAM,EAAE;AAJF,OAJN;AAUJC,MAAAA,sBAAsB,EAAE;AACpBJ,QAAAA,CAAC,EAAE,CADiB;AAEpBC,QAAAA,CAAC,EAAE,CAFiB;AAGpBC,QAAAA,KAAK,EAAE,EAHa;AAIpBC,QAAAA,MAAM,EAAE;AAJY;AAVpB,K;;;;;;;;;;;;;;;;AAkBiBE,gBAAAA,I,QAAAA,I,EAAMC,kB,QAAAA,kB;8BAC4B,KAAKnB,K,EAApDU,a,eAAAA,a,EAAeC,2B,eAAAA,2B;AACnBS,gBAAAA,W,GAAcF,I;AACdG,gBAAAA,c,GAAiBF,kB;;sBAEjB,OAAOD,IAAP,KAAgB,Q;;;;;;uBACIlC,aAAa,CAACsC,aAAd,CAA4B;AAC5CC,kBAAAA,IAAI,EAAEL,IADsC;AAE5CM,kBAAAA,SAAS,EAAEd;AAFiC,iBAA5B,C;;;AAApBU,gBAAAA,W;;;sBAMA,OAAOD,kBAAP,KAA8B,Q;;;;;;uBACPnC,aAAa,CAACsC,aAAd,CAA4B;AAC/CC,kBAAAA,IAAI,EAAEJ,kBADyC;AAE/CK,kBAAAA,SAAS,EAAEb;AAFoC,iBAA5B,C;;;AAAvBU,gBAAAA,c;;;iDAMG;AACHH,kBAAAA,IAAI,EAAEE,WADH;AAEHD,kBAAAA,kBAAkB,EAAEE;AAFjB,iB;;;;;;;;;;;;;;;;;;;iDAOSI,K;;;;;;;8BAKZ,KAAKC,K,EAHLvB,U,eAAAA,U,EACAR,c,eAAAA,c,sCACAQ,U;2EAA2C,E;AAA7Be,gBAAAA,I,yBAAAA,I,EAAMC,kB,yBAAAA,kB;kCAEE,KAAKQ,SAAL,E,EAAlBC,a,mBAAAA,a;AAERH,gBAAAA,KAAK,CAACI,cAAN;;uBAEsC,KAAKC,gBAAL,CAAsB;AACxDZ,kBAAAA,IAAI,EAAJA,IADwD;AAExDC,kBAAAA,kBAAkB,EAAlBA;AAFwD,iBAAtB,C;;;;AAAnCD,gBAAAA,I,SAAAA,I;AAAMC,gBAAAA,kB,SAAAA,kB;AAKHY,gBAAAA,I,qBACC5B,U;AACHyB,kBAAAA,aAAa,EAAbA;;AAGJ,uBAAOG,IAAI,CAACC,eAAZ;;AAEA,oBAAI,OAAOd,IAAP,KAAgB,QAApB,EAA8B;AAC1Ba,kBAAAA,IAAI,CAACb,IAAL,GAAYA,IAAZ;AACH;;AAED,oBAAI,OAAOC,kBAAP,KAA8B,QAAlC,EAA4C;AACxCY,kBAAAA,IAAI,CAACZ,kBAAL,GAA0BA,kBAA1B;AACH;;AAEDxB,gBAAAA,cAAc,CAAC;AAAEoC,kBAAAA,IAAI,EAAJA;AAAF,iBAAD,CAAd;;;;;;;;;;;;;;;;+BAIOE,I,EAAMT,S,EAAW;AACxB,WAAKU,QAAL,CAAc;AACVtB,QAAAA,QAAQ,EAAEqB,IADA;AAEVvB,QAAAA,aAAa,EAAEc;AAFL,OAAd;AAIH;;;qCAGgBS,I,EAAMT,S,EAAW;AAC9B,WAAKU,QAAL,CAAc;AACVjB,QAAAA,sBAAsB,EAAEgB,IADd;AAEVtB,QAAAA,2BAA2B,EAAEa;AAFnB,OAAd;AAIH;;;+BAGUW,Q,EAAU;AAAA,UACTC,MADS,GACE,KAAKV,KADP,CACTU,MADS;AAEjBA,MAAAA,MAAM,CAAC,MAAD,EAASD,QAAT,CAAN;AACH;;;0CAGqBA,Q,EAAU;AAAA,UACpBC,MADoB,GACT,KAAKV,KADI,CACpBU,MADoB;AAE5BA,MAAAA,MAAM,CAAC,oBAAD,EAAuBD,QAAvB,CAAN;AACH;;;gCAGWV,K,EAAOhB,S,EAAW;AAC1B,WAAKyB,QAAL,CAAc;AAAEzB,QAAAA,SAAS,EAATA;AAAF,OAAd;AACH;;;gCAEW;AAAA,UAEQ4B,MAFR,GAGJ,KAAKX,KAHD,CAEJY,QAFI,CAEQD,MAFR;AAIR,aAAOrD,aAAa,CAACuD,WAAd,CAA0BF,MAA1B,CAAP;AACH;;;wCAEmB;AAAA,UACR3C,eADQ,GACY,KAAKgC,KADjB,CACRhC,eADQ;;AAAA,6BAEU,KAAKiC,SAAL,EAFV;AAAA,UAERC,aAFQ,oBAERA,aAFQ;;AAIhBlC,MAAAA,eAAe,CAAC;AAAEqC,QAAAA,IAAI,EAAE;AAAEH,UAAAA,aAAa,EAAbA;AAAF;AAAR,OAAD,CAAf;AACH;;;kCAGa;AAAA,mCACgD,KAAKF,KADrD,CACFvB,UADE;AAAA,mEACyC,EADzC;AAAA,UACYe,IADZ,0BACYA,IADZ;AAAA,UACkBC,kBADlB,0BACkBA,kBADlB;AAGV,UAAMqB,cAAc,GAChBtB,IAAI,YAAYuB,IAAhB,IAAwBvB,IAAI,YAAYwB,IAAxC,GACMC,GAAG,CAACC,eAAJ,CAAoB1B,IAApB,CADN,GAEMA,IAHV;AAIA,UAAM2B,YAAY,GACd1B,kBAAkB,YAAYsB,IAA9B,IACAtB,kBAAkB,YAAYuB,IAD9B,GAEMC,GAAG,CAACC,eAAJ,CAAoBzB,kBAApB,CAFN,GAGMA,kBAJV;AAMA,aAAO;AACHD,QAAAA,IAAI,EAAEsB,cADH;AAEHrB,QAAAA,kBAAkB,EAAE0B;AAFjB,OAAP;AAIH;;;6BAEQ;AAAA,yBACmD,KAAK7C,KADxD;AAAA,UACGS,SADH,gBACGA,SADH;AAAA,UACcQ,sBADd,gBACcA,sBADd;AAAA,UACsCL,QADtC,gBACsCA,QADtC;AAAA,mCAKD,KAAKc,KALJ,CAIDvB,UAJC;AAAA,UAIae,IAJb,0BAIaA,IAJb;AAAA,UAImB4B,GAJnB,0BAImBA,GAJnB;AAAA,UAIwB3B,kBAJxB,0BAIwBA,kBAJxB;AAAA,UAI4Ca,eAJ5C,0BAI4CA,eAJ5C;AAOL,aACI,oBAAC,aAAD;AAAe,QAAA,KAAK,EAAC,eAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAK,QAAA,SAAS,EAAE,+BAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oCADJ,EAGI,oBAAC,IAAD;AACI,QAAA,KAAK,EAAEvB,SADX;AAEI,QAAA,cAAc,EAAE,SAFpB;AAGI,QAAA,SAAS,EAAE,gBAHf;AAII,QAAA,QAAQ,EAAE,KAAKsC,WAJnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAMI,oBAAC,GAAD;AAAK,QAAA,KAAK,EAAC,eAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QANJ,EAOI,oBAAC,GAAD;AAAK,QAAA,KAAK,EAAC,2BAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,QAPJ,CAHJ,EAaI;AAAK,QAAA,SAAS,EAAE,wBAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SACKtC,SAAS,KAAK,CAAd,IACG,oBAAC,YAAD,gBACQ;AACAQ,QAAAA,sBAAsB,EAAtBA,sBADA;AAEAL,QAAAA,QAAQ,EAARA,QAFA;AAGAM,QAAAA,IAAI,EAAJA,IAHA;AAIAC,QAAAA,kBAAkB,EAAlBA,kBAJA;AAKA2B,QAAAA,GAAG,EAAHA;AALA,OADR;AAQI,QAAA,qBAAqB,EACjB,KAAKE,qBATb;AAWI,QAAA,UAAU,EAAE,KAAKC,UAXrB;AAYI,QAAA,gBAAgB,EAAE,KAAKC,gBAZ3B;AAaI,QAAA,UAAU,EAAE,KAAKC,UAbrB;AAcI,QAAA,aAAa,EAAE,KAAKC;AAdxB,SAeQpE,aAAa,CAACqE,IAAd,CAAmB,KAAK3B,KAAxB,EAA+B,CAC/B,SAD+B,EAE/B,SAF+B,EAG/B,QAH+B,CAA/B,CAfR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAFR,EAwBKjB,SAAS,KAAK,CAAd,IACG,oBAAC,eAAD,oBACQ,KAAK6C,WAAL,EADR;AAEI,QAAA,IAAI,EAAEtB,eAFV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,SAzBR,CAbJ,CADJ,CADJ;AAiDH;;;;;;;;;;;EAzMkBtD,S,mEA4ClBO,Q,wJAkCAA,Q,2JAQAA,Q,2JAQAA,Q,gKAMAA,Q,iKAMAA,Q,uJAmBAA,Q;SA7HCoB,Q;AA4MNA,QAAQ,CAACkD,SAAT,GAAqB;AACjB9D,EAAAA,iBAAiB,EAAEd,SAAS,CAAC6E;AADZ,CAArB;AAGAnD,QAAQ,CAACoD,YAAT,GAAwB,EAAxB;;;;;;;;;;;;0BAzOM3D,kB;0BAEAC,e;0BAMAK,kB;0BAkBAC,Q","sourcesContent":["import React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { reduxForm, formValueSelector } from 'redux-form';\nimport DocumentTitle from 'react-document-title';\nimport { connect } from 'react-redux';\nimport { HelperService } from '/services';\n\nimport { autobind } from 'core-decorators';\n\nimport { DesignerForm, DesignerPreview } from './components';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\n\nimport { AppCleanHOC } from '/components';\n\nimport {\n    loadingsSelector,\n    initialValuesSelector,\n    abortPageRequests,\n    getDesignerById,\n    updateDesigner,\n    designerValidation,\n    formFieldNamesSelector\n} from './modules';\n\nimport './Designer.scss';\n\nconst formFieldsSelector = formValueSelector('Designer');\n\nconst mapStateToProps = state => ({\n    loading: loadingsSelector(state),\n    initialValues: initialValuesSelector(state),\n    formValues: formFieldsSelector(state, ...formFieldNamesSelector())\n});\n\nconst mapDispatchToProps = {\n    abortPageRequests,\n    getDesignerById,\n    updateDesigner,\n    designerValidation\n};\n\nexport default\n@connect(\n    mapStateToProps,\n    mapDispatchToProps\n)\n@reduxForm({\n    form: 'Designer',\n    enableReinitialize: true,\n    validate: designerValidation\n})\n@AppCleanHOC\nclass Designer extends Component {\n    state = {\n        activeTab: 0,\n        logoPixelCrop: {},\n        background_picturePixelCrop: {},\n        logoCrop: {\n            x: 0,\n            y: 0,\n            width: 30,\n            height: 30\n        },\n        background_pictureCrop: {\n            x: 0,\n            y: 0,\n            width: 30,\n            height: 30\n        }\n    };\n\n    async getCroppedImages({ logo, background_picture }) {\n        const { logoPixelCrop, background_picturePixelCrop } = this.state;\n        let croppedLogo = logo;\n        let corppedBgImage = background_picture;\n\n        if (typeof logo !== 'string') {\n            croppedLogo = await HelperService.getCroppedImg({\n                file: logo,\n                pixelCrop: logoPixelCrop\n            });\n        }\n\n        if (typeof background_picture !== 'string') {\n            corppedBgImage = await HelperService.getCroppedImg({\n                file: background_picture,\n                pixelCrop: background_picturePixelCrop\n            });\n        }\n\n        return {\n            logo: croppedLogo,\n            background_picture: corppedBgImage\n        };\n    }\n\n    @autobind\n    async onUpdateCLick(event) {\n        let {\n            formValues,\n            updateDesigner,\n            formValues: { logo, background_picture } = {}\n        } = this.props;\n        const { restaurant_id } = this.getSearch();\n\n        event.preventDefault();\n\n        ({ logo, background_picture } = await this.getCroppedImages({\n            logo,\n            background_picture\n        }));\n\n        const body = {\n            ...formValues,\n            restaurant_id\n        };\n\n        delete body.restaurant_name;\n\n        if (typeof logo !== 'string') {\n            body.logo = logo;\n        }\n\n        if (typeof background_picture !== 'string') {\n            body.background_picture = background_picture;\n        }\n\n        updateDesigner({ body });\n    }\n\n    @autobind\n    onLogoCrop(crop, pixelCrop) {\n        this.setState({\n            logoCrop: crop,\n            logoPixelCrop: pixelCrop\n        });\n    }\n\n    @autobind\n    onBackgroundCrop(crop, pixelCrop) {\n        this.setState({\n            background_pictureCrop: crop,\n            background_picturePixelCrop: pixelCrop\n        });\n    }\n\n    @autobind\n    onDropLogo(accepted) {\n        const { change } = this.props;\n        change('logo', accepted);\n    }\n\n    @autobind\n    onDropBackgroundImage(accepted) {\n        const { change } = this.props;\n        change('background_picture', accepted);\n    }\n\n    @autobind\n    onChangeTab(event, activeTab) {\n        this.setState({ activeTab });\n    }\n\n    getSearch() {\n        const {\n            location: { search }\n        } = this.props;\n        return HelperService.parseSearch(search);\n    }\n\n    componentDidMount() {\n        const { getDesignerById } = this.props;\n        const { restaurant_id } = this.getSearch();\n\n        getDesignerById({ body: { restaurant_id } });\n    }\n\n    @autobind\n    getPreviews() {\n        const { formValues: { logo, background_picture } = {} } = this.props;\n\n        const logoForPreview =\n            logo instanceof File || logo instanceof Blob\n                ? URL.createObjectURL(logo)\n                : logo;\n        const bgForPreview =\n            background_picture instanceof File ||\n            background_picture instanceof Blob\n                ? URL.createObjectURL(background_picture)\n                : background_picture;\n\n        return {\n            logo: logoForPreview,\n            background_picture: bgForPreview\n        };\n    }\n\n    render() {\n        const { activeTab, background_pictureCrop, logoCrop } = this.state;\n\n        const {\n            formValues: { logo, url, background_picture, restaurant_name }\n        } = this.props;\n\n        return (\n            <DocumentTitle title='Page designer'>\n                <div className={'app-static-container designer'}>\n                    <h1>Restaurant page designer</h1>\n\n                    <Tabs\n                        value={activeTab}\n                        indicatorColor={'primary'}\n                        className={'designer__tabs'}\n                        onChange={this.onChangeTab}\n                    >\n                        <Tab label='Configuration' />\n                        <Tab label='Restaurant header preview' />\n                    </Tabs>\n\n                    <div className={'designer__tabs-content'}>\n                        {activeTab === 0 && (\n                            <DesignerForm\n                                {...{\n                                    background_pictureCrop,\n                                    logoCrop,\n                                    logo,\n                                    background_picture,\n                                    url\n                                }}\n                                onDropBackgroundImage={\n                                    this.onDropBackgroundImage\n                                }\n                                onDropLogo={this.onDropLogo}\n                                onBackgroundCrop={this.onBackgroundCrop}\n                                onLogoCrop={this.onLogoCrop}\n                                onUpdateCLick={this.onUpdateCLick}\n                                {...HelperService.pick(this.props, [\n                                    'loading',\n                                    'invalid',\n                                    'change'\n                                ])}\n                            />\n                        )}\n                        {activeTab === 1 && (\n                            <DesignerPreview\n                                {...this.getPreviews()}\n                                name={restaurant_name}\n                            />\n                        )}\n                    </div>\n                </div>\n            </DocumentTitle>\n        );\n    }\n}\n\nDesigner.propTypes = {\n    abortPageRequests: PropTypes.func\n};\nDesigner.defaultProps = {};\n"]},"metadata":{},"sourceType":"module"}