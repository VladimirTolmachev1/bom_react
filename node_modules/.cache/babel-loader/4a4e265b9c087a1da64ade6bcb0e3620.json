{"ast":null,"code":"import _objectSpread from \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\nimport { createSelector } from 'reselect';\nimport { managedRestaurantSelector } from '../restaurants';\nimport { getUnicOrderItemDescriptor, dishOrderWithSelectedExtrasDecorator } from './checkout.helpers';\nexport var checkoutSelector = function checkoutSelector(_ref) {\n  var checkout = _ref.checkout;\n  return checkout;\n};\nexport var uuidsByItemDecriptorsSelector = function uuidsByItemDecriptorsSelector(_ref2) {\n  var checkout = _ref2.checkout;\n  return checkout.uuidsByItemDecriptors;\n};\nexport var allItemsUuidsSelector = function allItemsUuidsSelector(_ref3) {\n  var checkout = _ref3.checkout;\n  return checkout.allUuids || [];\n};\nexport var itemsByUuidsSelector = function itemsByUuidsSelector(_ref4) {\n  var checkout = _ref4.checkout;\n  return checkout.itemsByUuids || {};\n};\nexport var checkoutChargeSelector = function checkoutChargeSelector(_ref5) {\n  var checkout = _ref5.checkout;\n  return checkout.charge;\n};\nexport var isStripeChargeLoadingSelector = createSelector([checkoutChargeSelector], function (charge) {\n  return charge.isLoading;\n});\nexport var stripeChargeTransactionIdSelector = createSelector([checkoutChargeSelector], function (charge) {\n  return charge.stripeTransactionId;\n});\nexport var checkoutItemsSelector = createSelector([itemsByUuidsSelector, allItemsUuidsSelector], function (byUuids, allUuids) {\n  return allUuids.map(function (uuid) {\n    return dishOrderWithSelectedExtrasDecorator(byUuids[uuid]);\n  });\n});\nexport var checkoutItemsForPaymentsSelector = createSelector([itemsByUuidsSelector, allItemsUuidsSelector], function (byUuids, allUuids) {\n  var unicItemsByDescriptors = allUuids.reduce(function (itemsByDescriptors, uuid) {\n    var _dishOrderWithSelecte = dishOrderWithSelectedExtrasDecorator(_objectSpread({}, byUuids[uuid])),\n        id = _dishOrderWithSelecte.id,\n        _dishOrderWithSelecte2 = _dishOrderWithSelecte.amount,\n        amount = _dishOrderWithSelecte2 === void 0 ? 1 : _dishOrderWithSelecte2,\n        dish_id = _dishOrderWithSelecte.dish_id,\n        _dishOrderWithSelecte3 = _dishOrderWithSelecte.selectedExtras,\n        selectedExtras = _dishOrderWithSelecte3 === void 0 ? [] : _dishOrderWithSelecte3,\n        selectedSize = _dishOrderWithSelecte.selectedSize;\n\n    var item = {\n      id: id,\n      amount: amount,\n      dish_id: dish_id,\n      selectedExtras: selectedExtras.map(function (_ref6) {\n        var id = _ref6.id,\n            _ref6$amount = _ref6.amount,\n            amount = _ref6$amount === void 0 ? 1 : _ref6$amount;\n        return {\n          id: id,\n          amount: amount\n        };\n      })\n    };\n\n    if (selectedSize) {\n      item.selectedSize = typeof selectedSize === 'object' ? selectedSize.id : selectedSize;\n    }\n\n    var descriptor = getUnicOrderItemDescriptor(item);\n\n    if (itemsByDescriptors[descriptor]) {\n      itemsByDescriptors[descriptor].amount += item.amount;\n    } else {\n      itemsByDescriptors[descriptor] = item;\n    }\n\n    return itemsByDescriptors;\n  }, {});\n  return Object.values(unicItemsByDescriptors);\n});\nexport var totalPriceSelector = createSelector(checkoutItemsSelector, managedRestaurantSelector, function (order, _ref7) {\n  var _ref7$sales_tax = _ref7.sales_tax,\n      sales_tax = _ref7$sales_tax === void 0 ? 0 : _ref7$sales_tax,\n      _ref7$delivery_fee = _ref7.delivery_fee,\n      delivery_fee = _ref7$delivery_fee === void 0 ? 0 : _ref7$delivery_fee;\n  var subtotal = 0;\n  var totalOrderItems = 0;\n  order.forEach(function (item) {\n    subtotal += item.totalPrice;\n    totalOrderItems += item.amount || 1;\n  });\n  var totalAll = subtotal + subtotal / 100 * Number(delivery_fee) + subtotal / 100 * Number(sales_tax);\n  var total = Math.round(totalAll * 100) / 100;\n  return {\n    totalOrderItems: totalOrderItems,\n    subtotal: subtotal,\n    deliveryFee: delivery_fee,\n    salesTax: sales_tax,\n    total: total\n  };\n});\nexport var activeCheckoutStepSelector = function activeCheckoutStepSelector(_ref8) {\n  var checkout = _ref8.checkout;\n  return checkout.ui.activeStep;\n};\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(checkoutSelector, \"checkoutSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(uuidsByItemDecriptorsSelector, \"uuidsByItemDecriptorsSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(allItemsUuidsSelector, \"allItemsUuidsSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(itemsByUuidsSelector, \"itemsByUuidsSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(checkoutChargeSelector, \"checkoutChargeSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(isStripeChargeLoadingSelector, \"isStripeChargeLoadingSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(stripeChargeTransactionIdSelector, \"stripeChargeTransactionIdSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(checkoutItemsSelector, \"checkoutItemsSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(checkoutItemsForPaymentsSelector, \"checkoutItemsForPaymentsSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(totalPriceSelector, \"totalPriceSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n  reactHotLoader.register(activeCheckoutStepSelector, \"activeCheckoutStepSelector\", \"/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/home/vladimir/workspace/bestonlinemenus.loc/frontend/src/modules/checkout/checkout.selectors.js"],"names":["createSelector","managedRestaurantSelector","getUnicOrderItemDescriptor","dishOrderWithSelectedExtrasDecorator","checkoutSelector","checkout","uuidsByItemDecriptorsSelector","uuidsByItemDecriptors","allItemsUuidsSelector","allUuids","itemsByUuidsSelector","itemsByUuids","checkoutChargeSelector","charge","isStripeChargeLoadingSelector","isLoading","stripeChargeTransactionIdSelector","stripeTransactionId","checkoutItemsSelector","byUuids","map","uuid","checkoutItemsForPaymentsSelector","unicItemsByDescriptors","reduce","itemsByDescriptors","id","amount","dish_id","selectedExtras","selectedSize","item","descriptor","Object","values","totalPriceSelector","order","sales_tax","delivery_fee","subtotal","totalOrderItems","forEach","totalPrice","totalAll","Number","total","Math","round","deliveryFee","salesTax","activeCheckoutStepSelector","ui","activeStep"],"mappings":"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","sourcesContent":["import { createSelector } from 'reselect';\nimport { managedRestaurantSelector } from '../restaurants';\nimport {\n  getUnicOrderItemDescriptor,\n  dishOrderWithSelectedExtrasDecorator,\n} from './checkout.helpers';\n\nexport const checkoutSelector = ({ checkout }) => checkout;\nexport const uuidsByItemDecriptorsSelector = ({ checkout }) =>\n  checkout.uuidsByItemDecriptors;\nexport const allItemsUuidsSelector = ({ checkout }) => checkout.allUuids || [];\nexport const itemsByUuidsSelector = ({ checkout }) =>\n  checkout.itemsByUuids || {};\nexport const checkoutChargeSelector = ({ checkout }) => checkout.charge;\n\nexport const isStripeChargeLoadingSelector = createSelector(\n  [checkoutChargeSelector],\n  charge => charge.isLoading,\n);\n\nexport const stripeChargeTransactionIdSelector = createSelector(\n  [checkoutChargeSelector],\n  charge => charge.stripeTransactionId,\n);\n\nexport const checkoutItemsSelector = createSelector(\n  [itemsByUuidsSelector, allItemsUuidsSelector],\n  (byUuids, allUuids) =>\n    allUuids.map(uuid => dishOrderWithSelectedExtrasDecorator(byUuids[uuid])),\n);\n\nexport const checkoutItemsForPaymentsSelector = createSelector(\n  [itemsByUuidsSelector, allItemsUuidsSelector],\n  (byUuids, allUuids) => {\n    const unicItemsByDescriptors = allUuids.reduce(\n      (itemsByDescriptors, uuid) => {\n        const {\n          id,\n          amount = 1,\n          dish_id,\n          selectedExtras = [],\n          selectedSize,\n        } = dishOrderWithSelectedExtrasDecorator({ ...byUuids[uuid] });\n\n        const item = {\n          id,\n          amount,\n          dish_id,\n          selectedExtras: selectedExtras.map(({ id, amount = 1 }) => ({\n            id,\n            amount,\n          })),\n        };\n\n        if (selectedSize) {\n          item.selectedSize =\n            typeof selectedSize === 'object' ? selectedSize.id : selectedSize;\n        }\n\n        const descriptor = getUnicOrderItemDescriptor(item);\n\n        if (itemsByDescriptors[descriptor]) {\n          itemsByDescriptors[descriptor].amount += item.amount;\n        } else {\n          itemsByDescriptors[descriptor] = item;\n        }\n\n        return itemsByDescriptors;\n      },\n      {},\n    );\n\n    return Object.values(unicItemsByDescriptors);\n  },\n);\n\nexport const totalPriceSelector = createSelector(\n  checkoutItemsSelector,\n  managedRestaurantSelector,\n  (order, { sales_tax = 0, delivery_fee = 0 }) => {\n    let subtotal = 0;\n    let totalOrderItems = 0;\n\n    order.forEach(item => {\n      subtotal += item.totalPrice;\n      totalOrderItems += item.amount || 1;\n    });\n\n    const totalAll =\n      subtotal +\n      (subtotal / 100) * Number(delivery_fee) +\n      (subtotal / 100) * Number(sales_tax);\n\n    const total = Math.round(totalAll * 100) / 100;\n\n    return {\n      totalOrderItems,\n      subtotal,\n      deliveryFee: delivery_fee,\n      salesTax: sales_tax,\n      total,\n    };\n  },\n);\n\nexport const activeCheckoutStepSelector = ({ checkout }) =>\n  checkout.ui.activeStep;\n"]},"metadata":{},"sourceType":"module"}